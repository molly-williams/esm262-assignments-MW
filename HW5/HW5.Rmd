---
title: "Assignment 5"
author: "Austin Richards and Molly Williams"
date: "6/7/2019"
output: 
  html_document:
    toc: true
    toc_float: true
---

### Background
We chose to develop our package based on ENSO data, as climate change is expected to intensify impacts from El Nino and La Nina. We created two functions to summarize the monthly ENSO data from 1950-2018 (which ranges from -3 to 3 and is based on sea surface temperature monitoring) and three functions to estimate weather impacts and costs from increased risk of environmental disturbances. 

Data source: [NOAA ESRL](https://www.esrl.noaa.gov/psd/data/correlation/oni.data)


1) **Summary functions**
    - enso_extremes(): Function that finds the minimum/maximum values from the data set
    - enso_plot() Function that graphs the data over time

2) **Impact calculation functions**
    - predict_precip(): predict precipitation in a specific location based on ONI value using a linear model. lm under the hood, in function user inputs index score, output will be rain fall. Rainfall ~ ONI (user will input value between -3 and 3)
    - predict_temp(): predict air temperature using the same inputs as above

3) **Cost estimation function**
    - enso_cost(): Damages from environmental disturbances (typhoons, etc) based on ONI 


**Delete later**: 

The package should contain:

a) some sample data
b) documentation for ALL functions
c) a vignette that shows how to use several of the functions with the sample data
d) 3 separate tests - (next weeks lecture)
e) Multi-dimensional array examples
- e.g., find temp at multiple sites for same month/year (temp[year,month,site])
- could do a full join on two data frames with data for separate sites
- can perform functions on arrays easier than data frames 


### Load packages and source function file
```{r setup, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(zoo)
source("oni_function.R")

```

### Import and wrangle data 
```{r}

# Import data from ONI databse (NOAA ESRL)
enso_data_raw <-
  read_delim(
    "oni data.csv",
    delim = " ",
    col_types = cols(.default = col_character())
  )

    
# Organize and tidy
## Each row has a single ONI value for a month and year
enso_data <-  enso_data_raw %>% 
  tidyr::gather(key="month", value="ONI", -(year)) %>% 
  dplyr::transmute(year = parse_double(year),
                   month = parse_double(month),
                   ONI = parse_double(ONI))

enso_data <- mutate(enso_data, date=with(enso_data, sprintf("%d-%02d", year, month)))

#Adding weather data from Port Moresby, Papua New Guinea, taken from NOAA data tool and creating a dataframe which contains monthly ONI value along with Precipitation and Temperature for every month available (up tell 2003)
weather <- read_csv("port_moresby_weather.csv")
colnames(weather)[colnames(weather)=="DATE"] <- "date"

port_moresby <- left_join(weather, enso_data, by = "date")

```


### Summary functions
```{r}

enso_extremes(enso_data)

enso_plot(enso_data)

# This looks pretty weird... should we do any smoothing on it or add any labels for what the values mean? (e.g. add a band for where it's considered La Nina vs El Nino)
  
```


```{r}
try <- lm(PRCP ~ ONI, data = port_moresby)

try$coefficients
```


```{r}
predict_precip = function(data) {
  model <- lm(PRCP ~ ONI, data = (data))
  
 return(model$coefficients) 
}

predict_precip(port_moresby)
```


### Impact functions
```{r}


```


### Cost function
```{r}


```






